# 环境变量配置说明

## 概述

为了保护敏感信息，项目使用环境变量来管理配置。所有敏感信息（数据库密码、API密钥等）都应通过环境变量设置，而不是直接写在配置文件中。

## 配置方式

### 方式1：使用 .env 文件（推荐开发环境）

1. 复制示例文件：
   ```bash
   cp .env.example .env
   ```

2. 编辑 `.env` 文件，填入实际值：
   ```bash
   vim .env
   ```

3. 使用工具加载环境变量（需要安装 `dotenv` 或类似工具）

### 方式2：直接设置环境变量（推荐生产环境）

#### Linux/Mac 系统：

```bash
# 临时设置（当前会话有效）
export DATASOURCE_URL="jdbc:mysql://localhost:3306/miniapp?useSSL=false&useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai"
export DATASOURCE_USERNAME="root"
export DATASOURCE_PASSWORD="your_password"
export REDIS_HOST="localhost"
export REDIS_PASSWORD="your_password"
export JWT_SECRET="your_long_random_secret"
export WECHAT_APPID="your_appid"
export WECHAT_SECRET="your_secret"
export OSS_ACCESS_KEY_ID="your_key_id"
export OSS_ACCESS_KEY_SECRET="your_key_secret"
export OSS_BUCKET="your_bucket"

# 启动应用
java -jar miniapp-backend-0.0.1-SNAPSHOT.jar
```

#### 永久设置（添加到 ~/.bashrc 或 ~/.zshrc）：

```bash
# 编辑配置文件
vim ~/.bashrc  # 或 ~/.zshrc

# 添加环境变量
export DATASOURCE_URL="jdbc:mysql://localhost:3306/miniapp..."
export DATASOURCE_USERNAME="root"
# ... 其他变量

# 重新加载配置
source ~/.bashrc
```

### 方式3：使用启动脚本

创建启动脚本 `start.sh`：

```bash
#!/bin/bash

# 设置环境变量
export DATASOURCE_URL="jdbc:mysql://localhost:3306/miniapp..."
export DATASOURCE_USERNAME="root"
export DATASOURCE_PASSWORD="your_password"
# ... 其他变量

# 启动应用
java -jar miniapp-backend-0.0.1-SNAPSHOT.jar
```

然后运行：
```bash
chmod +x start.sh
./start.sh
```

### 方式4：使用 systemd service（推荐生产环境）

创建 `/etc/systemd/system/miniapp-backend.service`：

```ini
[Unit]
Description=Miniapp Backend Service
After=network.target

[Service]
Type=simple
User=your_user
WorkingDirectory=/opt/miniapp_frontend/miniapp-backend
Environment="DATASOURCE_URL=jdbc:mysql://localhost:3306/miniapp..."
Environment="DATASOURCE_USERNAME=root"
Environment="DATASOURCE_PASSWORD=your_password"
Environment="REDIS_HOST=localhost"
Environment="REDIS_PASSWORD=your_password"
Environment="JWT_SECRET=your_long_random_secret"
Environment="WECHAT_APPID=your_appid"
Environment="WECHAT_SECRET=your_secret"
Environment="OSS_ACCESS_KEY_ID=your_key_id"
Environment="OSS_ACCESS_KEY_SECRET=your_key_secret"
Environment="OSS_BUCKET=your_bucket"
ExecStart=/usr/bin/java -jar /opt/miniapp_frontend/miniapp-backend/target/miniapp-backend-0.0.1-SNAPSHOT.jar
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

然后：
```bash
sudo systemctl daemon-reload
sudo systemctl enable miniapp-backend
sudo systemctl start miniapp-backend
```

## 必需的环境变量

### 生产环境必需：

- `DATASOURCE_URL` - 数据库连接URL
- `DATASOURCE_USERNAME` - 数据库用户名
- `DATASOURCE_PASSWORD` - 数据库密码
- `REDIS_HOST` - Redis主机
- `REDIS_PASSWORD` - Redis密码（如果有）
- `JWT_SECRET` - JWT密钥（必须是安全的随机字符串）
- `WECHAT_APPID` - 微信小程序AppID
- `WECHAT_SECRET` - 微信小程序Secret
- `OSS_ACCESS_KEY_ID` - 阿里云OSS AccessKeyId
- `OSS_ACCESS_KEY_SECRET` - 阿里云OSS AccessKeySecret
- `OSS_BUCKET` - OSS存储桶名称

### 可选环境变量：

- `ADMIN_USERNAME` - 管理员用户名（默认：test）
- `ADMIN_PASSWORD` - 管理员密码（默认：test）
- `REDIS_PORT` - Redis端口（默认：6379）
- `REDIS_DATABASE` - Redis数据库编号（默认：0）

## 安全建议

1. **永远不要将 `.env` 文件提交到 Git**
2. **生产环境使用强密码和随机密钥**
3. **定期轮换密钥和密码**
4. **使用环境变量而不是配置文件存储敏感信息**
5. **限制访问服务器配置文件和环境变量的权限**

## 生成安全的 JWT Secret

```bash
# 使用 openssl
openssl rand -base64 64

# 使用 Python
python3 -c "import secrets; print(secrets.token_urlsafe(64))"
```

