-- 创建产品统计表
CREATE TABLE IF NOT EXISTS product_statistics (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  product_id BIGINT NOT NULL,
  product_name VARCHAR(255),
  category_id BIGINT,
  category_name VARCHAR(100),
  views INT DEFAULT 0 COMMENT '浏览次数',
  repurchase_count INT DEFAULT 0 COMMENT '复购人数',
  sales_amount DECIMAL(10, 2) DEFAULT 0 COMMENT '销售额',
  sales_count INT DEFAULT 0 COMMENT '销售笔数',
  statistic_date DATE NOT NULL COMMENT '统计日期',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY unique_product_date (product_id, statistic_date),
  KEY idx_statistic_date (statistic_date),
  KEY idx_product_id (product_id),
  KEY idx_category_id (category_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 创建日统计汇总表
CREATE TABLE IF NOT EXISTS daily_statistics (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  statistic_date DATE NOT NULL UNIQUE COMMENT '统计日期',
  total_views INT DEFAULT 0 COMMENT '总浏览次数',
  total_sales_amount DECIMAL(10, 2) DEFAULT 0 COMMENT '总销售额',
  total_sales_count INT DEFAULT 0 COMMENT '总销售笔数',
  total_repurchase INT DEFAULT 0 COMMENT '总复购人数',
  active_products INT DEFAULT 0 COMMENT '活跃商品数',
  new_users INT DEFAULT 0 COMMENT '新增用户',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  KEY idx_statistic_date (statistic_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 创建用户行为统计表
CREATE TABLE IF NOT EXISTS user_behavior_statistics (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT,
  behavior_type VARCHAR(50) COMMENT '行为类型: view(浏览), purchase(购买), repurchase(复购)',
  product_id BIGINT,
  behavior_date DATE NOT NULL,
  behavior_amount DECIMAL(10, 2) DEFAULT 0 COMMENT '相关金额',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  KEY idx_user_id (user_id),
  KEY idx_behavior_date (behavior_date),
  KEY idx_product_id (product_id),
  KEY idx_behavior_type (behavior_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 删除旧数据
DELETE FROM product_statistics;
DELETE FROM daily_statistics;

-- 初始化过去30天的模拟数据
INSERT INTO product_statistics (product_id, product_name, category_id, category_name, views, repurchase_count, sales_amount, sales_count, statistic_date) VALUES
-- 2025-10-26
(1, '女装连衣裙', 1, '女装', 150, 12, 1800.00, 8, '2025-10-26'),
(2, '男士T恤', 2, '男装', 120, 10, 960.00, 6, '2025-10-26'),
(3, '运动鞋', 3, '鞋类', 180, 15, 2700.00, 9, '2025-10-26'),
(4, '牛仔裤', 2, '男装', 95, 8, 760.00, 5, '2025-10-26'),
(5, '休闲外套', 1, '女装', 110, 9, 1650.00, 6, '2025-10-26'),

-- 2025-10-27
(1, '女装连衣裙', 1, '女装', 165, 13, 1950.00, 9, '2025-10-27'),
(2, '男士T恤', 2, '男装', 135, 11, 1080.00, 7, '2025-10-27'),
(3, '运动鞋', 3, '鞋类', 200, 16, 3000.00, 10, '2025-10-27'),
(4, '牛仔裤', 2, '男装', 110, 9, 880.00, 6, '2025-10-27'),
(5, '休闲外套', 1, '女装', 125, 10, 1875.00, 7, '2025-10-27'),

-- 2025-10-28
(1, '女装连衣裙', 1, '女装', 140, 11, 1680.00, 7, '2025-10-28'),
(2, '男士T恤', 2, '男装', 128, 10, 1024.00, 6, '2025-10-28'),
(3, '运动鞋', 3, '鞋类', 175, 14, 2625.00, 8, '2025-10-28'),
(4, '牛仔裤', 2, '男装', 100, 8, 800.00, 5, '2025-10-28'),
(5, '休闲外套', 1, '女装', 115, 9, 1725.00, 6, '2025-10-28'),

-- 2025-10-29
(1, '女装连衣裙', 1, '女装', 180, 14, 2160.00, 10, '2025-10-29'),
(2, '男士T恤', 2, '男装', 145, 12, 1160.00, 7, '2025-10-29'),
(3, '运动鞋', 3, '鞋类', 210, 17, 3150.00, 11, '2025-10-29'),
(4, '牛仔裤', 2, '男装', 120, 10, 960.00, 6, '2025-10-29'),
(5, '休闲外套', 1, '女装', 135, 11, 2025.00, 8, '2025-10-29'),

-- 2025-10-30
(1, '女装连衣裙', 1, '女装', 155, 12, 1860.00, 8, '2025-10-30'),
(2, '男士T恤', 2, '男装', 130, 11, 1040.00, 6, '2025-10-30'),
(3, '运动鞋', 3, '鞋类', 185, 15, 2775.00, 9, '2025-10-30'),
(4, '牛仔裤', 2, '男装', 105, 8, 840.00, 5, '2025-10-30'),
(5, '休闲外套', 1, '女装', 120, 9, 1800.00, 6, '2025-10-30'),

-- 2025-10-31
(1, '女装连衣裙', 1, '女装', 170, 13, 2040.00, 9, '2025-10-31'),
(2, '男士T恤', 2, '男装', 140, 11, 1120.00, 7, '2025-10-31'),
(3, '运动鞋', 3, '鞋类', 195, 16, 2925.00, 10, '2025-10-31'),
(4, '牛仔裤', 2, '男装', 115, 9, 920.00, 6, '2025-10-31'),
(5, '休闲外套', 1, '女装', 130, 10, 1950.00, 7, '2025-10-31'),

-- 2025-11-01
(1, '女装连衣裙', 1, '女装', 160, 12, 1920.00, 8, '2025-11-01'),
(2, '男士T恤', 2, '男装', 135, 11, 1080.00, 6, '2025-11-01'),
(3, '运动鞋', 3, '鞋类', 190, 15, 2850.00, 9, '2025-11-01'),
(4, '牛仔裤', 2, '男装', 110, 8, 880.00, 5, '2025-11-01'),
(5, '休闲外套', 1, '女装', 125, 10, 1875.00, 7, '2025-11-01'),

-- 2025-11-02
(1, '女装连衣裙', 1, '女装', 175, 14, 2100.00, 10, '2025-11-02'),
(2, '男士T恤', 2, '男装', 150, 12, 1200.00, 8, '2025-11-02'),
(3, '运动鞋', 3, '鞋类', 220, 18, 3300.00, 12, '2025-11-02'),
(4, '牛仔裤', 2, '男装', 125, 10, 1000.00, 7, '2025-11-02'),
(5, '休闲外套', 1, '女装', 140, 11, 2100.00, 8, '2025-11-02'),

-- 2025-11-03
(1, '女装连衣裙', 1, '女装', 145, 11, 1740.00, 7, '2025-11-03'),
(2, '男士T恤', 2, '男装', 125, 10, 1000.00, 6, '2025-11-03'),
(3, '运动鞋', 3, '鞋类', 170, 14, 2550.00, 8, '2025-11-03'),
(4, '牛仔裤', 2, '男装', 95, 7, 760.00, 4, '2025-11-03'),
(5, '休闲外套', 1, '女装', 110, 8, 1650.00, 5, '2025-11-03'),

-- 2025-11-04 到 2025-11-24 随机数据
(1, '女装连衣裙', 1, '女装', 158, 12, 1896.00, 8, '2025-11-04'),
(2, '男士T恤', 2, '男装', 138, 11, 1104.00, 6, '2025-11-04'),
(3, '运动鞋', 3, '鞋类', 192, 15, 2880.00, 9, '2025-11-04'),
(4, '牛仔裤', 2, '男装', 112, 8, 896.00, 5, '2025-11-04'),
(5, '休闲外套', 1, '女装', 127, 10, 1905.00, 7, '2025-11-04'),

(1, '女装连衣裙', 1, '女装', 172, 13, 2064.00, 9, '2025-11-05'),
(2, '男士T恤', 2, '男装', 142, 12, 1136.00, 7, '2025-11-05'),
(3, '运动鞋', 3, '鞋类', 208, 17, 3120.00, 11, '2025-11-05'),
(4, '牛仔裤', 2, '男装', 118, 9, 944.00, 6, '2025-11-05'),
(5, '休闲外套', 1, '女装', 133, 10, 1995.00, 7, '2025-11-05'),

(1, '女装连衣裙', 1, '女装', 168, 13, 2016.00, 9, '2025-11-06'),
(2, '男士T恤', 2, '男装', 140, 11, 1120.00, 7, '2025-11-06'),
(3, '运动鞋', 3, '鞋类', 205, 16, 3075.00, 10, '2025-11-06'),
(4, '牛仔裤', 2, '男装', 115, 9, 920.00, 6, '2025-11-06'),
(5, '休闲外套', 1, '女装', 130, 10, 1950.00, 7, '2025-11-06'),

(1, '女装连衣裙', 1, '女装', 152, 12, 1824.00, 8, '2025-11-07'),
(2, '男士T恤', 2, '男装', 132, 10, 1056.00, 6, '2025-11-07'),
(3, '运动鞋', 3, '鞋类', 188, 15, 2820.00, 9, '2025-11-07'),
(4, '牛仔裤', 2, '男装', 108, 8, 864.00, 5, '2025-11-07'),
(5, '休闲外套', 1, '女装', 122, 9, 1830.00, 6, '2025-11-07'),

(1, '女装连衣裙', 1, '女装', 165, 13, 1980.00, 9, '2025-11-08'),
(2, '男士T恤', 2, '男装', 138, 11, 1104.00, 6, '2025-11-08'),
(3, '运动鞋', 3, '鞋类', 200, 16, 3000.00, 10, '2025-11-08'),
(4, '牛仔裤', 2, '男装', 120, 9, 960.00, 6, '2025-11-08'),
(5, '休闲外套', 1, '女装', 135, 10, 2025.00, 7, '2025-11-08'),

(1, '女装连衣裙', 1, '女装', 148, 11, 1776.00, 8, '2025-11-09'),
(2, '男士T恤', 2, '男装', 128, 10, 1024.00, 6, '2025-11-09'),
(3, '运动鞋', 3, '鞋类', 182, 14, 2730.00, 9, '2025-11-09'),
(4, '牛仔裤', 2, '男装', 102, 7, 816.00, 5, '2025-11-09'),
(5, '休闲外套', 1, '女装', 115, 8, 1725.00, 6, '2025-11-09'),

(1, '女装连衣裙', 1, '女装', 162, 12, 1944.00, 8, '2025-11-10'),
(2, '男士T恤', 2, '男装', 135, 11, 1080.00, 6, '2025-11-10'),
(3, '运动鞋', 3, '鞋类', 195, 15, 2925.00, 9, '2025-11-10'),
(4, '牛仔裤', 2, '男装', 112, 8, 896.00, 5, '2025-11-10'),
(5, '休闲外套', 1, '女装', 128, 10, 1920.00, 7, '2025-11-10'),

(1, '女装连衣裙', 1, '女装', 170, 13, 2040.00, 9, '2025-11-11'),
(2, '男士T恤', 2, '男装', 142, 11, 1136.00, 7, '2025-11-11'),
(3, '运动鞋', 3, '鞋类', 210, 17, 3150.00, 11, '2025-11-11'),
(4, '牛仔裤', 2, '男装', 125, 10, 1000.00, 7, '2025-11-11'),
(5, '休闲外套', 1, '女装', 140, 11, 2100.00, 8, '2025-11-11'),

(1, '女装连衣裙', 1, '女装', 155, 12, 1860.00, 8, '2025-11-12'),
(2, '男士T恤', 2, '男装', 130, 10, 1040.00, 6, '2025-11-12'),
(3, '运动鞋', 3, '鞋类', 185, 15, 2775.00, 9, '2025-11-12'),
(4, '牛仔裤', 2, '男装', 110, 8, 880.00, 5, '2025-11-12'),
(5, '休闲外套', 1, '女装', 125, 9, 1875.00, 6, '2025-11-12'),

(1, '女装连衣裙', 1, '女装', 150, 11, 1800.00, 8, '2025-11-13'),
(2, '男士T恤', 2, '男装', 125, 10, 1000.00, 6, '2025-11-13'),
(3, '运动鞋', 3, '鞋类', 180, 14, 2700.00, 9, '2025-11-13'),
(4, '牛仔裤', 2, '男装', 105, 8, 840.00, 5, '2025-11-13'),
(5, '休闲外套', 1, '女装', 120, 9, 1800.00, 6, '2025-11-13'),

(1, '女装连衣裙', 1, '女装', 165, 13, 1980.00, 9, '2025-11-14'),
(2, '男士T恤', 2, '男装', 135, 11, 1080.00, 6, '2025-11-14'),
(3, '运动鞋', 3, '鞋类', 195, 15, 2925.00, 10, '2025-11-14'),
(4, '牛仔裤', 2, '男装', 115, 9, 920.00, 6, '2025-11-14'),
(5, '休闲外套', 1, '女装', 130, 10, 1950.00, 7, '2025-11-14'),

(1, '女装连衣裙', 1, '女装', 175, 14, 2100.00, 10, '2025-11-15'),
(2, '男士T恤', 2, '男装', 145, 12, 1160.00, 7, '2025-11-15'),
(3, '运动鞋', 3, '鞋类', 210, 17, 3150.00, 11, '2025-11-15'),
(4, '牛仔裤', 2, '男装', 120, 10, 960.00, 6, '2025-11-15'),
(5, '休闲外套', 1, '女装', 135, 11, 2025.00, 8, '2025-11-15'),

(1, '女装连衣裙', 1, '女装', 160, 12, 1920.00, 8, '2025-11-16'),
(2, '男士T恤', 2, '男装', 138, 11, 1104.00, 6, '2025-11-16'),
(3, '运动鞋', 3, '鞋类', 200, 16, 3000.00, 10, '2025-11-16'),
(4, '牛仔裤', 2, '男装', 115, 9, 920.00, 6, '2025-11-16'),
(5, '休闲外套', 1, '女装', 128, 10, 1920.00, 7, '2025-11-16'),

(1, '女装连衣裙', 1, '女装', 145, 11, 1740.00, 7, '2025-11-17'),
(2, '男士T恤', 2, '男装', 128, 10, 1024.00, 6, '2025-11-17'),
(3, '运动鞋', 3, '鞋类', 180, 14, 2700.00, 8, '2025-11-17'),
(4, '牛仔裤', 2, '男装', 100, 7, 800.00, 5, '2025-11-17'),
(5, '休闲外套', 1, '女装', 115, 8, 1725.00, 6, '2025-11-17'),

(1, '女装连衣裙', 1, '女装', 170, 13, 2040.00, 9, '2025-11-18'),
(2, '男士T恤', 2, '男装', 142, 12, 1136.00, 7, '2025-11-18'),
(3, '运动鞋', 3, '鞋类', 205, 16, 3075.00, 10, '2025-11-18'),
(4, '牛仔裤', 2, '男装', 120, 9, 960.00, 6, '2025-11-18'),
(5, '休闲外套', 1, '女装', 135, 10, 2025.00, 7, '2025-11-18'),

(1, '女装连衣裙', 1, '女装', 155, 12, 1860.00, 8, '2025-11-19'),
(2, '男士T恤', 2, '男装', 132, 10, 1056.00, 6, '2025-11-19'),
(3, '运动鞋', 3, '鞋类', 190, 15, 2850.00, 9, '2025-11-19'),
(4, '牛仔裤', 2, '男装', 110, 8, 880.00, 5, '2025-11-19'),
(5, '休闲外套', 1, '女装', 125, 9, 1875.00, 6, '2025-11-19'),

(1, '女装连衣裙', 1, '女装', 165, 13, 1980.00, 9, '2025-11-20'),
(2, '男士T恤', 2, '男装', 138, 11, 1104.00, 6, '2025-11-20'),
(3, '运动鞋', 3, '鞋类', 200, 16, 3000.00, 10, '2025-11-20'),
(4, '牛仔裤', 2, '男装', 115, 9, 920.00, 6, '2025-11-20'),
(5, '休闲外套', 1, '女装', 130, 10, 1950.00, 7, '2025-11-20'),

(1, '女装连衣裙', 1, '女装', 172, 13, 2064.00, 9, '2025-11-21'),
(2, '男士T恤', 2, '男装', 145, 12, 1160.00, 7, '2025-11-21'),
(3, '运动鞋', 3, '鞋类', 215, 17, 3225.00, 11, '2025-11-21'),
(4, '牛仔裤', 2, '男装', 125, 10, 1000.00, 7, '2025-11-21'),
(5, '休闲外套', 1, '女装', 140, 11, 2100.00, 8, '2025-11-21'),

(1, '女装连衣裙', 1, '女装', 148, 11, 1776.00, 8, '2025-11-22'),
(2, '男士T恤', 2, '男装', 132, 10, 1056.00, 6, '2025-11-22'),
(3, '运动鞋', 3, '鞋类', 185, 14, 2775.00, 9, '2025-11-22'),
(4, '牛仔裤', 2, '男装', 105, 8, 840.00, 5, '2025-11-22'),
(5, '休闲外套', 1, '女装', 120, 9, 1800.00, 6, '2025-11-22'),

(1, '女装连衣裙', 1, '女装', 160, 12, 1920.00, 8, '2025-11-23'),
(2, '男士T恤', 2, '男装', 138, 11, 1104.00, 6, '2025-11-23'),
(3, '运动鞋', 3, '鞋类', 200, 16, 3000.00, 10, '2025-11-23'),
(4, '牛仔裤', 2, '男装', 115, 9, 920.00, 6, '2025-11-23'),
(5, '休闲外套', 1, '女装', 130, 10, 1950.00, 7, '2025-11-23'),

(1, '女装连衣裙', 1, '女装', 155, 12, 1860.00, 8, '2025-11-24'),
(2, '男士T恤', 2, '男装', 135, 11, 1080.00, 6, '2025-11-24'),
(3, '运动鞋', 3, '鞋类', 190, 15, 2850.00, 9, '2025-11-24'),
(4, '牛仔裤', 2, '男装', 110, 8, 880.00, 5, '2025-11-24'),
(5, '休闲外套', 1, '女装', 125, 9, 1875.00, 6, '2025-11-24');

-- 初始化日统计数据
INSERT INTO daily_statistics (statistic_date, total_views, total_sales_amount, total_sales_count, total_repurchase, active_products) VALUES
('2025-10-26', 655, 7870.00, 34, 54, 5),
('2025-10-27', 735, 8785.00, 39, 59, 5),
('2025-10-28', 688, 7734.00, 32, 52, 5),
('2025-10-29', 800, 9295.00, 45, 62, 5),
('2025-10-30', 720, 8150.00, 36, 55, 5),
('2025-10-31', 770, 8905.00, 41, 59, 5),
('2025-11-01', 720, 8410.00, 36, 54, 5),
('2025-11-02', 875, 10100.00, 47, 66, 5),
('2025-11-03', 600, 6700.00, 27, 40, 5),
('2025-11-04', 729, 8581.00, 35, 54, 5),
('2025-11-05', 792, 9416.00, 42, 63, 5),
('2025-11-06', 758, 9081.00, 40, 58, 5),
('2025-11-07', 702, 8394.00, 33, 49, 5),
('2025-11-08', 746, 8889.00, 39, 59, 5),
('2025-11-09', 675, 8071.00, 33, 50, 5),
('2025-11-10', 714, 8581.00, 34, 54, 5),
('2025-11-11', 792, 9426.00, 42, 63, 5),
('2025-11-12', 715, 8390.00, 37, 54, 5),
('2025-11-13', 680, 8140.00, 34, 50, 5),
('2025-11-14', 740, 8805.00, 40, 57, 5),
('2025-11-15', 800, 9395.00, 45, 64, 5),
('2025-11-16', 741, 8864.00, 38, 56, 5),
('2025-11-17', 653, 7749.00, 30, 45, 5),
('2025-11-18', 772, 9140.00, 41, 59, 5),
('2025-11-19', 717, 8501.00, 34, 53, 5),
('2025-11-20', 748, 8954.00, 40, 58, 5),
('2025-11-21', 797, 9449.00, 43, 63, 5),
('2025-11-22', 670, 8071.00, 34, 48, 5),
('2025-11-23', 743, 8874.00, 40, 57, 5),
('2025-11-24', 635, 7545.00, 32, 49, 5);

-- 创建索引
CREATE INDEX idx_product_statistics_date_range ON product_statistics(statistic_date, product_id);
CREATE INDEX idx_daily_statistics_date_range ON daily_statistics(statistic_date);
