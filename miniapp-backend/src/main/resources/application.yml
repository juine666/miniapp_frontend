server:
  port: 8081

spring:
  application:
    name: miniapp-backend
  jackson:
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false
  datasource:
    url: ${DATASOURCE_URL:jdbc:mysql://localhost:3306/miniapp?useSSL=false&useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true}
    username: ${DATASOURCE_USERNAME:root}
    password: ${DATASOURCE_PASSWORD:root}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      auto-commit: true
      connection-test-query: SELECT 1
  flyway:
    enabled: true
    baseline-on-migrate: true
    validate-on-migrate: false
  web:
    resources:
      # 禁用默认的静态资源映射，避免 API 路径被当作静态资源
      add-mappings: false
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: ${REDIS_DATABASE:0}
      timeout: 3000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms
        shutdown-timeout: 100ms
        # 禁用RESP3协议，使用RESP2以避免认证问题
        client-name: miniapp-backend
# MyBatis Plus配置
mybatis-plus:
  configuration:
    # 使用标准输出，显示完整的SQL语句和参数值（开发环境推荐）
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    # 开启SQL格式化
    map-underscore-to-camel-case: true
  # 显示MyBatis Plus的banner
  global-config:
    banner: false

logging:
  level:
    root: INFO
    org.springframework.web: INFO
    com.stylemirror.miniapp_backend: DEBUG
    com.stylemirror.miniapp_backend.controller.AuthController: DEBUG
    com.stylemirror.miniapp_backend.common.GlobalExceptionHandler: ERROR
    org.springframework.web.client: DEBUG
  file:
    name: logs/miniapp-backend.log
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

springdoc:
  api-docs:
    enabled: true
  swagger-ui:
    path: /swagger-ui.html

security:
  jwt:
    secret: ${JWT_SECRET:change_this_to_a_long_random_secret}
    issuer: stylemirror
    expirationMinutes: 43200 # 30 days
  user:
     name: ${ADMIN_USERNAME:test}
     password: ${ADMIN_PASSWORD:test}
admin:
  defaultUsername: ${ADMIN_DEFAULT_USERNAME:admin}
  defaultPassword: ${ADMIN_DEFAULT_PASSWORD:admin123}

wechat:
  appid: ${WECHAT_APPID:your_wechat_appid}
  secret: ${WECHAT_SECRET:your_wechat_secret}

oss:
  endpoint: ${OSS_ENDPOINT:oss-cn-shenzhen.aliyuncs.com}
  accessKeyId: ${OSS_ACCESS_KEY_ID:替换为你的AccessKeyId}
  accessKeySecret: ${OSS_ACCESS_KEY_SECRET:替换为你的AccessKeySecret}
  bucket: ${OSS_BUCKET:twoshop}
  publicBaseUrl: ${OSS_PUBLIC_BASE_URL:https://twoshop.oss-cn-shenzhen.aliyuncs.com}

aliyun:
  access-key-id: ${ALIYUN_ACCESS_KEY_ID:替换为你的AccessKeyId}
  access-key-secret: ${ALIYUN_ACCESS_KEY_SECRET:替换为你的AccessKeySecret}
  region-id: ${ALIYUN_REGION_ID:cn-hangzhou}
  tts:
    app-key: ${ALIYUN_TTS_APP_KEY:替换为你的TTS AppKey}

# 测试模式配置
test:
  mode: false  # 是否启用测试模式（允许无认证访问）- 生产环境请设置为false
  user:
    id: 1  # 测试模式下使用的默认用户ID（需要确保数据库中存在该用户）

