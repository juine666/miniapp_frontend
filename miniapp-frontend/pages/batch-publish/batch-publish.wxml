<view class="batch-container">
  <!-- 操作栏 -->
  <view class="action-bar">
    <button class="action-btn primary" bindtap="chooseImages">
      <text class="btn-icon">📷</text>
      <text>批量选择图片</text>
      <text class="btn-tip">（每张图片一个商品）</text>
    </button>
    <button class="action-btn" bindtap="addProduct">
      <text class="btn-icon">➕</text>
      <text>手动添加</text>
    </button>
  </view>
  
  <!-- 粘贴文本区域（可选） -->
  <view class="paste-section">
    <view class="paste-header">
      <text class="paste-label">或粘贴聊天记录文本</text>
      <text class="paste-tip">自动解析商品信息</text>
    </view>
    <textarea 
      class="paste-input" 
      placeholder="例如：哑铃一样两个 五元一起打包出"
      bindinput="onPasteText"
    ></textarea>
  </view>
  
  <!-- 商品列表 -->
  <view class="products-list">
    <view class="product-item" wx:for="{{products}}" wx:key="index">
      <view class="product-header">
        <text class="product-index">商品 {{index + 1}}</text>
        <view class="header-actions">
          <button class="delete-btn" bindtap="deleteProduct" data-index="{{index}}">删除</button>
        </view>
      </view>
      
      <!-- 图片区域 -->
      <view class="images-section">
        <view class="images-grid">
          <view class="image-item" wx:for="{{item.images}}" wx:for-item="imgUrl" wx:for-index="imgIndex" wx:key="imgIndex">
            <image class="uploaded-image" src="{{imgUrl}}" mode="aspectFill"></image>
            <view class="delete-img-btn" bindtap="deleteImage" data-product-index="{{index}}" data-image-index="{{imgIndex}}">×</view>
          </view>
          <view class="add-image" wx:if="{{item.images.length < 3}}" bindtap="addImageToProduct" data-index="{{index}}">
            <text class="add-icon">+</text>
            <text class="add-text">添加图片</text>
          </view>
        </view>
      </view>
      
      <!-- 商品信息 -->
      <view class="product-form">
        <view class="form-row">
          <text class="form-label">分类：</text>
          <picker 
            mode="selector" 
            range="{{categoryList}}" 
            range-key="name"
            value="{{item.categoryIndex || 0}}"
            bindchange="onCategoryChange"
            data-index="{{index}}"
          >
            <view class="picker-value">
              {{item.categoryId && categoryList[item.categoryIndex || 0] ? categoryList[item.categoryIndex || 0].name : '请选择分类'}}
            </view>
          </picker>
        </view>
        
        <view class="form-row">
          <text class="form-label">描述：</text>
          <textarea 
            class="desc-input" 
            placeholder="体验描述"
            value="{{item.description}}"
            bindinput="onDescriptionInput"
            data-index="{{index}}"
          ></textarea>
        </view>
        
        <!-- 下架了价格字段 -->
        <!-- <view class="form-row">
          <text class="form-label">价格：</text>
          <input 
            class="price-input" 
            type="digit" 
            placeholder="0.00"
            value="{{item.price}}"
            bindinput="onPriceInput"
            data-index="{{index}}"
          />
          <text class="unit">元</text>
        </view> -->
        
        <button class="publish-single-btn" bindtap="publishSingle" data-index="{{index}}}">分享此体验</button>
      </view>
    </view>
  </view>
  
  <!-- 轮流类提示：下空了批量发布功能并隠藏了价格字段 -->
  <!-- <view class="batch-footer" wx:if="{{products.length > 0}}">
    <button class="batch-publish-btn" bindtap="batchPublish" disabled="{{publishing}}">
      {{publishing ? '发布中...' : '批量发布 (' + products.length + ')'}}
    </button>
  </view> -->
  
  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{products.length === 0}}">
    <text class="empty-text">暂无商品</text>
    <text class="empty-tip">点击"选择图片"或"粘贴文本"添加商品</text>
  </view>
</view>

